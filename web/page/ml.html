<!DOCTYPE html>
<html lang="en">
    <head>
        <title>机器学习车牌数据</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="../src/bootstrap-3.2.0-dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-2">
                <h2>历年拍牌最后30秒的价格走势图（与线性回归对比）</h2>
                <div class="list-group" id="bid_year_list">
                    <a class="list-group-item active" data-year="2016" data-quater="1">2016年</a>
                    <!--<a class="list-group-item" data-year="2016" data-quater="2">2016年第二季度</a>
                    <a class="list-group-item" data-year="2016" data-quater="3">2016年第三季度</a>
                    <a class="list-group-item active" data-year="2016" data-quater="4">2016年第四季度</a>-->
                    <a class="list-group-item" data-year="2015" data-quater="1">2015年</a>
                    <!--<a class="list-group-item" data-year="2015" data-quater="2">2015年第二季度</a>
                    <a class="list-group-item" data-year="2015" data-quater="3">2015年第三季度</a>
                    <a class="list-group-item" data-year="2015" data-quater="4">2015年第四季度</a>-->
                    <a class="list-group-item" data-year="2014" data-quater="1">2014年</a>
                    <!--<a class="list-group-item" data-year="2014" data-quater="2">2014年第二季度</a>
                    <a class="list-group-item" data-year="2014" data-quater="3">2014年第三季度</a>
                    <a class="list-group-item" data-year="2014" data-quater="4">2014年第四季度</a>-->
                </div>
            </div>
            <div class="col-lg-10" style="min-height:600px;" id="bid_data_year"></div>
        </div>
    </div>
    </body>
    <script src="../src/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../src/bootstrap-3.2.0-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../src/echarts/echarts.min.js"></script>
    <script>
        $(function(){
            var h=document.documentElement.clientHeight;
            $("#bid_data_year").css({"height":h+"px"});
            var myChart_bid_data_year=echarts.init(document.getElementById("bid_data_year"));
            
            getBidDataByYear(setBidYearChart);

            /*****************get bid data by year*****************************/
            function getBidDataByYear(cb,year,quater){
                if(!year){
                    year="2016";
                    quater="4";
                }
                $.getJSON("../file/bid_"+year+"_time_price.json",function(res){
                    cb(res,year,quater);
                });
            };
            /**************select bid year 最后30秒 对比图****************/
            $("#bid_year_list a").click(function(e){
                e.preventDefault();
                $(this).siblings().removeClass("active");
                $(this).addClass("active");
                var year=$(this).data("year");
                var quater=$(this).data("quater");
                getBidDataByYear(setBidYearChart,year,quater);
            });
            /***********set bid data year chart 最后30秒的对比图**************/
            function setBidYearChart(data,year,quater){
                var month_data=[];
                var stand_regress_data=[];
                for(var month=0;month<data.length;month++){
                    var bid_month=data[month].bid_month;
                    for(var i=0;i<data[month].rows.length;i++){
                        var row=data[month].rows[i];
                        month_data.push([row.system_time.substr(3),row.lowest_price,bid_month]);
                        stand_regress_data.push([row.system_time.substr(3),row.stand_regress_value,bid_month]);
                    }
                }
                //console.log(month_data);
                //x axis is 29:30, 29:31
                var x_axis_data=[];
                for(var i=30;i<60;i++){
                    x_axis_data.push("29:"+i);
                }
                // 指定图表的配置项和数据
                var option = {
                    title: {
                        text: year +'年每月拍卖最后30秒价格散点图'
                    },
                    legend: {
                        left: 'center',
                        data: ['实际价格','线性回归']
                    },
                    tooltip:{
                        formatter:function(params){
                            return params.value[2]+' '+params.value[0]+' '+params.seriesName+':'+params.value[1];
                        }
                    },
                    xAxis: {
                        type:'category',
                        data:x_axis_data
                    },
                    yAxis: {
                        type:'value',
                        scale: true
                    },
                    series: [{
                        name:"实际价格",
                        type:'scatter',
                        data:month_data
                    },{
                        name:'线性回归',
                        type:'scatter',
                        data:stand_regress_data
                    }]
                };

                // 使用刚指定的配置项和数据显示图表。
                myChart_bid_data_year.setOption(option);
            };            

        });
    </script>
</html>