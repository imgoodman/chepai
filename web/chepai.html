<!DOCTYPE html>
<html lang="en">
    <head>
        <title>车牌数据</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="../src/bootstrap-3.2.0-dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12" style="min-height:600px;" id="summary_main"></div>
        </div>
        <div class="row">
            <div class="col-lg-12" style="min-height:600px;" id="summary_price"></div>
        </div>
        <div class="row">
            <div class="col-lg-12" style="min-height:600px;" id="summary_price_margin"></div>
        </div>
    </div>
    </body>
    <script src="../src/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../src/bootstrap-3.2.0-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../src/echarts/echarts.min.js"></script>
    <script>
        $(function(){
            var h=document.documentElement.clientHeight;
            $("#summary_main,#summary_price,#summary_price_margin").css({"height":h+"px"});
            var myChart=echarts.init(document.getElementById("summary_main"));
            var myChart_summary_price=echarts.init(document.getElementById("summary_price"));
            var myChart_summary_price_margin=echarts.init(document.getElementById("summary_price_margin"));

            function getSummaryData(fn){
                $.getJSON("../file/summary.json",function(res){
                    fn(res);
                });
            };
            getSummaryData(setEChartOption);

            function setEChartOption(data){
                setMainChart(data);
                setMainPriceChart(data);
                setMainPriceMarginChart(data);                
            };


            /****summary all chart*****/
            function setMainChart(data){                
                // 指定图表的配置项和数据
                var option = {
                    title: {
                        text: '历年车牌拍卖数据(不包含无警示价的月份)'
                    },
                    tooltip: {
                        trigger:'axis'
                    },
                    legend: {
                        data:['警示价','最低成交价','平均成交价','参拍人数','拍卖额度']
                    },
                    xAxis: {
                        type:'category',
                        data: data.map(function(item){return item.bid_month})
                    },
                    yAxis: {
                        type:'value'
                    },
                    dataZoom:[
                        {
                            type:'slider',
                            show:true,
                            xAxisIndex:[0],
                            start:80,
                            end:100
                        }
                    ],
                    series: [
                        {
                            name: '警示价',
                            type: 'line',
                            data: data.map(function(item){return item.alert_price})
                        },
                        {
                            name:'最低成交价',
                            type:'line',
                            data:data.map(function(item){return item.lowest_price})
                        },
                        {
                            name:'平均成交价',
                            type:'line',
                            data:data.map(function(item){return item.avg_price})
                        },
                        {
                            name:'参拍人数',
                            type:'line',
                            data:data.map(function(item){return item.bid_people_num})
                        },
                        {
                            name:'拍卖额度',
                            type:'line',
                            data:data.map(function(item){return item.license_num})
                        }
                    ]
                };

                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            };

            /****summary price chart****/
            function setMainPriceChart(data){
                // 指定图表的配置项和数据
                var option = {
                    title: {
                        text: '历年车牌拍卖价格数据'
                    },
                    tooltip: {
                        trigger:'axis'
                    },
                    legend: {
                        data:['警示价','最低成交价','平均成交价']
                    },
                    xAxis: {
                        type:'category',
                        data: data.map(function(item){ if(parseInt(item.alert_price)>0) return item.bid_month})
                    },
                    yAxis: {
                        type:'value',
                        min:'dataMin'
                    },
                    dataZoom:[
                        {
                            type:'slider',
                            show:true,
                            xAxisIndex:[0],
                            start:80,
                            end:100
                        }
                    ],
                    series: [
                        {
                            name: '警示价',
                            type: 'line',
                            data: data.map(function(item){ if(parseInt(item.alert_price)>0) return item.alert_price})
                        },
                        {
                            name:'最低成交价',
                            type:'line',
                            data:data.map(function(item){ if(parseInt(item.alert_price)>0) return item.lowest_price})
                        },
                        {
                            name:'平均成交价',
                            type:'line',
                            data:data.map(function(item){ if(parseInt(item.alert_price)>0) return item.avg_price})
                        }
                    ]
                };

                // 使用刚指定的配置项和数据显示图表。
                myChart_summary_price.setOption(option);
            };

            /****summary price margin chart****/
            function setMainPriceMarginChart(data){
                var option = {
                    title: {
                        text: '历年车牌拍卖价格数据（不包含无警示价的月份）'
                    },
                    tooltip: {
                        trigger:'axis'
                    },
                    legend: {
                        data:['成交价与警示价的差价']
                    },
                    xAxis: {
                        type:'category',
                        data: data.map(function(item){ if(parseInt(item.alert_price)>0) return item.bid_month})
                    },
                    yAxis: {
                        type:'value',
                        min:'dataMin'
                    },
                    dataZoom:[
                        {
                            type:'slider',
                            show:true,
                            xAxisIndex:[0],
                            start:80,
                            end:100
                        }
                    ],
                    series: [
                        {
                            name: '成交价与警示价的差价',
                            type: 'line',
                            data: data.map(function(item){ if(parseInt(item.alert_price)>0) return (item.lowest_price - item.alert_price)})
                        }
                    ]
                };

                // 使用刚指定的配置项和数据显示图表。
                myChart_summary_price_margin.setOption(option);
            };

        });
    </script>
</html>